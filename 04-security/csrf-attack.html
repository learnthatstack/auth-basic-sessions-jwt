<!DOCTYPE html>
<html>
<head>
  <title>Malicious Site - CSRF Attack Demo</title>
  <!--
    IMPORTANT: This file must be served from http://localhost:3005
    Run: node 04-security/malicious-server.js
    Then visit: http://localhost:3005

    DO NOT open this file directly (file://) - it won't work!
    See README-CSRF-DEMO.md for complete instructions.
  -->
  <style>
    body {
      font-family: Arial;
      padding: 40px;
      max-width: 600px;
      margin: 0 auto;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      text-align: center;
    }
    .prize-box {
      background: white;
      color: #333;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      margin: 20px 0;
    }
    .prize-button {
      background: #ff6b6b;
      color: white;
      border: none;
      padding: 20px 40px;
      font-size: 18px;
      font-weight: bold;
      border-radius: 50px;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(255,107,107,0.4);
      transition: all 0.3s;
    }
    .prize-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(255,107,107,0.6);
    }
    .warning {
      background: #fff3cd;
      border: 2px solid #ffc107;
      color: #856404;
      padding: 15px;
      margin: 20px 0;
      border-radius: 5px;
      font-size: 14px;
    }
    h1 { margin-top: 0; }
    .icon { font-size: 60px; margin: 20px 0; }
  </style>
</head>
<body>
  <h1>Congratulations! You've Won!</h1>

  <div class="prize-box">
    <div class="icon">&#127873;</div>
    <h2>Claim Your Prize Now!</h2>
    <p>You've been selected to win a FREE gift card!</p>
    <p>Click below to claim your reward:</p>

    <!-- CSRF Attack Form -->
    <!-- This form targets the victim's authenticated application -->
    <form id="csrfForm" action="http://127.0.0.1:3004/tasks" method="POST" style="display: inline;">
      <input type="hidden" name="title" value="Hacked via CSRF!">
      <input type="hidden" name="completed" value="false">
      <button type="submit" class="prize-button" onclick="return confirmAttack()">
        Claim Your Prize!
      </button>
    </form>
  </div>

  <div class="warning">
    <strong>WARNING - EDUCATIONAL DEMO:</strong> This is a controlled CSRF attack demonstration.
    This simulates a malicious website trying to create a task on behalf of an authenticated user.
    The attack targets http://localhost:3004/tasks (your own local server).
    <br><br>
    <strong>Setup Required:</strong> This page must be served from http://localhost:3005
    <br>Run: <code>node 04-security/malicious-server.js</code>
  </div>

  <div style="margin-top: 30px; background: rgba(255,255,255,0.1); padding: 20px; border-radius: 5px;">
    <h3>What's happening here?</h3>
    <p style="font-size: 14px; text-align: left;">
      1. User is logged into the legitimate app (localhost:3004)<br>
      2. User visits this malicious site (could be via phishing email)<br>
      3. Form submits POST request to create a malicious task<br>
      4. Browser attempts to include cookies automatically<br>
      5. <strong>With SameSite='strict':</strong> Attack FAILS (cookie not sent, "Missing token" error)<br>
      6. <strong>With SameSite='lax':</strong> Attack FAILS (cookies not sent for cross-site POST)<br>
      7. <strong>With SameSite='none' or not set:</strong> Attack would SUCCEED (malicious task created)<br>
      8. <strong>Why this matters:</strong> Demonstrates state-changing CSRF attack and SameSite protection
    </p>
  </div>

  <script>
    function confirmAttack() {
      // Show what's about to happen
      const confirmed = confirm(
        'CSRF Attack Simulation\n\n' +
        'This will send a POST request to:\n' +
        'http://localhost:3004/tasks\n\n' +
        'Attempting to create a malicious task:\n' +
        '"Hacked via CSRF!"\n\n' +
        'Your browser will attempt to include cookies.\n\n' +
        'Click OK to see if the attack succeeds or fails\n' +
        '(depends on SameSite cookie configuration)'
      );

      if (confirmed) {
        console.log('CSRF Attack Initiated!');
        console.log('Target: http://localhost:3004/tasks');
        console.log('Method: POST');
        console.log('Payload: { title: "Hacked via CSRF!", completed: false }');
        console.log('Goal: Create a malicious task in victim\'s task list');
        console.log('Browser will attempt to include cookies from localhost:3004');
        console.log('With SameSite=strict: Cookie will NOT be sent, attack FAILS (Missing token error)');
        console.log('With SameSite=lax: Cookie will NOT be sent for cross-site POST, attack FAILS');
        console.log('With SameSite=none or not set: Attack would SUCCEED (task created)');
        return true; // Allow form submission
      }
      return false; // Cancel
    }
  </script>
</body>
</html>
